<!-- HTML -->
<form on:submit='handleSubmit( event )'>
  <div>
    {{#each Object.keys(value) as key}}
      <InputSlider  label={{key}}
                    bind:value=value[key]
                    limitMax=255
                    colorMax={{colors.hasOwnProperty(key)?colors[key]:'#fff'}}
                    />
    {{/each}}
    <InputSlider  label=duration
                  bind:value=duration
                  limitMax=60
                  limitStep=0.1 
                  colorMin='#aaa'
                  colorMax='#aaa'
                  valueSuffix=s
                  /> 
  </div>
  <div class="buttons">
    <input type="button" on:click="handleRefresh( event )" class="btnRefresh" value="Get Current">
    <input type="button" on:click="handleSubmit( event )"  class="btnPost" value="Set Values">
  </div>
</form>

<DebugArea bind:value=value />


<!-- CSS -->
<style>
  div.buttons {
    margin-top: 10px;
    display: flex;
    background-color: #ccc;
    padding: 10px 15px;
  }

  div.buttons input[type=button]:hover {
    background-color: #3b6989;
  }

  div.buttons input[type=button] {
    background-color: #5b8dad;
    border: 0;
    color: #ffffff;
    flex-grow: 1;
    margin: 2px 10px;
    padding: 8px 10px;
  }
</style>


<!-- Code -->
<script>
import InputSlider from '../components/InputSlider.html';
import DebugArea from '../components/DebugArea.html';

import { restGET, restPOST, displayError } from '../util.js';

export default {
  data () {
    return {
      value: {
      },
      colors: {
        'R': '#f00',
        'G': '#0f0',
        'B': '#00f'
      },
      duration: 1.0
    }
  },

  components: { 
    InputSlider,
    DebugArea
  },

  oncreate () {
    var self = this;    
    // Workaround for failing to set values on load
    self.set( { value: self.get('value') } );

    restGET('./status', function(error, data) {
      if (error) {
        displayError(error, true);
        return;
      }
      self.set( { value: data } );
    });
  },

  methods: {
    handleRefresh: function ( event ) {
      // prevent the page from reloading
      event.preventDefault();

      var self = this;
      restGET('./status', function(error, data) {
        displayError(error, false);
        if (error)
          return;
        self.set( { value: data } );
      });
    },

    handleSubmit: function ( event ) {
      // prevent the page from reloading
      event.preventDefault();

      // Get value and create shallow copy
      var value = Object.assign({}, this.get( 'value' ));
  
      // Convert duration to ms
      value.duration = Math.floor(this.get('duration') * 10) * 100;

      restPOST('./status', value, function(error) {
        displayError(error, false);
      });
    }
  }
};
</script>
